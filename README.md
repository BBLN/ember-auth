# ember-auth

`ember-auth` provides token authentication support to
[ember.js](http://emberjs.com/).

# Overview

`ember-auth` expects your server to implement token authentication.
It will then query for this token upon sign in; append this token for every
API request generated by the model query and persistence; and destroy this
token upon sign out.

# Status

## Is `ember-auth` production-ready?

No. The module isn't even finished; and in any case, I haven't learnt how to
write proper unit tests for ember modules yet.
Perhaps [you can help](https://github.com/heartsentwined/ember-auth#contributing)?

# Installation

`ember-auth` distribution files lives in `lib/`.

Coffeescript files are in `src/`.

# Pre-req

`ember-auth` expects your server to provide an API interface with
token authentication support.
*An example of setting up token authentication in rails and devise will
be posted soon in the wiki.*

The token authentication API should expose two end points:
* a `POST` route for token creation
  * This should return the authentication token and the user model ID
    upon successful token creation in a JSON hash.
* a `DELETE` route for token destruction

Your server should also use proper HTTP status codes, i.e. the 2xx series for
successful actions, and the 4xx series for errors. In particular, the following
will be relevant:
* `200 OK`:           general pages, or returning protected content upon
                      successful authentication
* `201 Created`:      suggested response code for successful token creation
* `400 Bad Request`:  suggested response code for wrong parameters when
                      consuming an API end point
* `401 Unauthorized`: trying to access protected content without proper
                      authentication
* `404 Not Found`:    ah, good old 404.

At present `ember-auth` only supports `DS.RESTAdapter`.

# Usage

## Config

Let's say your server exposes a token authentication interface as follows:
* `POST /users/sign_in` for token creation (sign in)
  * expects `email` and `password` as params
  * sample response: `{user_id: 1, auth_token: "jL3hbrhni82yxIHUD"}`
* `DELETE /users/sign_out` for token destruction (sign out)
  * expects `auth_token` as param
  * (no response requirement)

```coffeescript
Auth.Config.reopen
  tokenCreateUrl: '/users/sign_in'
  tokenDestroyUrl: '/users/sign_out'
  tokenKey: 'auth_token'
  idKey: 'user_id'
```

## Persistence adapter

Persistence adapter setup: you will use `Auth.RESTAdapeter`; it is an
extension of `DS.RESTAdapter`.

```coffeescript
App.Store = DS.Store.extend
  revision: 11 # or whatever suitable
  adapter: Auth.RESTAdapter.create()
```

## Sign in/out views and templates

### 1. Widget style

"Widget" style sign in/out forms, for example at the end of a navigation bar.
The distinctive characteristic is that they do not have dedicated routes;
and that they are contained in a small view area within the app.

Make a `view` and a `template` for the authorization form area:

```coffeescript
App.AuthView = Em.View.extend
  templateName: 'auth'
```

```html
<script type="text/x-handlebars" data-template-name="auth">
  {{#if Auth.authToken}}
    {{view App.SignOutView}}
  {{else}}
    {{view App.SignInView}}
  {{/if}}
</script>
```

Note the use of `Auth.authToken` as the condition. `ember-auth` will store
the authentication token here when "signed in", and it will set it to `null`
when "signed out".

The sign in form:

```coffeescript
App.SignInView = Em.View.extend
  templateName: 'sign_in'

  email:    null
  password: null

  submit: (evt, view) ->
    evt.preventDefault()
    evt.stopPropagation()
    Auth.signIn
      email:    @get 'email'
      password: @get 'password'
```

```html
<script type="text/x-handlebars" data-template-name="sign_in">
  <form>
    <label>Email</label>
    {{view Ember.TextField valueBinding="email" valueBinding="view.email"}}
    <label>Password</label>
    {{view Ember.TextField valueBinding="password" valueBinding="view.password"}}
    <button>Sign In</button>
  </form>
</script>
```

Here we use the `Auth.signIn` helper. It accepts a hash of params that will
be passed to the API call.

The sign out form:

```coffeescript
App.SignOutView = Em.View.extend
  templateName: 'sign_out'

  submit: (evt, view) ->
    evt.preventDefault()
    evt.stopPropagation()
    Auth.signOut()
```

```html
<script type="text/x-handlebars" data-template-name="sign_out">
  <form>
    <button>Sign Out</button>
  </form>
</script>
```

The `Auth.signOut` helper has the same signature as the `Auth.signIn` helper,
except that it will pass the authentication token as a parameter by default,
at the key specified in `Auth.Config.tokenKey`.
The [FAQ](https://github.com/heartsentwined/ember-auth/wiki/FAQ) has an
explanation of this default behavior.

### 2. Full page style

"Full page" style, e.g. a "sign_in" route where the sign in form itself
is the main content of the whole page.
The distinctive characteristic is that sign in / out pages have their own routes.

Make a `route`, a `controller` and a `template` for the sign in page:

```coffeescript
App.Router.map ->
  @route 'sign_in'
```

```coffeescript
App.SignInRoute = Ember.Route.extend()
```

```coffeescript
App.SignInController = Ember.ObjectController.extend
  email: null
  password: null

  signIn: ->
    Auth.signIn
      email:    @get 'email'
      password: @get 'password'
```

```html
<script type="text/x-handlebars" data-template-name="sign_in">
  <form>
    <label>Email</label>
    {{view Ember.TextField valueBinding="email" valueBinding="email"}}
    <label>Password</label>
    {{view Ember.TextField valueBinding="password" valueBinding="password"}}
    <button {{action "signIn"}}>Sign In</button>
  </form>
</script>
```

We register a `signIn` action to our Sign In button, and then use the
`Auth.signIn` helper to sign the user in.  The `Auth.signIn` helper is
explained in the Widget style section.

The sign out page:

```coffeescript
App.Router.map ->
  @route 'sign_out'
```

```coffeescript
App.SignOutRoute = Ember.Route.extend()
```

```coffeescript
App.SignOutController = Ember.ObjectController.extend
  signOut: ->
    Auth.signOut()
```

```html
<script type="text/x-handlebars" data-template-name="sign_in">
  <form>
    <button {{action "signOut"}}>Sign Out</button>
  </form>
</script>
```

Again, we register a `signOut` action on the button; the `Auth.signOut` helper
is explained in the Widget style section.

## Auth-only routes

Authenticated-only routes setup: you will use `Auth.Route`; it is an
extension of `Ember.Route`.

The route `panel` - let's say, pointing to the user control panel - should
be a protected route:

```coffeescript
App.PanelRoute = Auth.Route.extend()
```

## Further use cases

The source codes at `src/auth.coffee` is a comprehensive list of public API
and helper methods; `src/config.coffee` contains an exhaustive list of
configurable options.

# Contributing

You are welcome! As usual:

1. Fork
2. Branch
3. Hack
4. Commit
5. Pull request

## Todo

* a full-blown rails + devise + ember-auth tutorial

# License

GPL 3.0
